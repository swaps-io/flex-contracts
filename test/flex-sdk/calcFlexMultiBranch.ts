import { expect } from 'chai';

import { calcFlexMultiBranch, FlexError } from '../../@swaps-io/flex-sdk';

describe('flex-sdk/calcFlexMultiBranch', function () {
  it('Should not calc multi branch of 2 mismatching leaves of tree with 2 leaves', function () {
    expect(() => {
      calcFlexMultiBranch({
        tree: [
          '0x1111111111111111111111111111111111111111111111111111111111111111',
          '0x2222222222222222222222222222222222222222222222222222222222222222',
        ],
        leaves: [
          '0x1111111111111111111111111111111111111111111111111111111111111111',
          '0x3333333333333333333333333333333333333333333333333333333333333333',
        ],
      });
    }).throws(FlexError);
  });

  it('Should calc multi branch of 2 leaves of tree with 2 leaves', function () {
    const branch = calcFlexMultiBranch({
      tree: [
        '0x1111111111111111111111111111111111111111111111111111111111111111',
        '0x2222222222222222222222222222222222222222222222222222222222222222',
      ],
      leaves: [
        '0x1111111111111111111111111111111111111111111111111111111111111111',
        '0x2222222222222222222222222222222222222222222222222222222222222222',
      ],
    });
    expect(branch).deep.equal({
      branch: [],
      flags: [
        true,
      ],
    });
  });

  it('Should calc multi branch of 2 leaves of tree with 3 leaves', function () {
    const branch = calcFlexMultiBranch({
      tree: [
        '0x1111111111111111111111111111111111111111111111111111111111111111',
        [
          '0x2222222222222222222222222222222222222222222222222222222222222222',
          '0x3333333333333333333333333333333333333333333333333333333333333333',
        ]
      ],
      leaves: [
        '0x1111111111111111111111111111111111111111111111111111111111111111',
        '0x2222222222222222222222222222222222222222222222222222222222222222',
      ],
    });
    expect(branch).deep.equal({
      branch: [
        '0x3333333333333333333333333333333333333333333333333333333333333333',
      ],
      flags: [
        false,
        true,
      ],
    });
  });

  it('Should calc multi branch of 3 leaves of tree with 3 leaves', function () {
    const branch = calcFlexMultiBranch({
      tree: [
        '0x1111111111111111111111111111111111111111111111111111111111111111',
        [
          '0x2222222222222222222222222222222222222222222222222222222222222222',
          '0x3333333333333333333333333333333333333333333333333333333333333333',
        ]
      ],
      leaves: [
        '0x1111111111111111111111111111111111111111111111111111111111111111',
        '0x2222222222222222222222222222222222222222222222222222222222222222',
        '0x3333333333333333333333333333333333333333333333333333333333333333',
      ],
    });
    expect(branch).deep.equal({
      branch: [],
      flags: [
        true,
        true,
      ],
    });
  });

  it('Should calc multi branch of 2 leaves of tree with 7 leaves', function () {
    const branch = calcFlexMultiBranch({
      tree: [
        [ // 0x60c25b70d66af589f985b3cf4732585b8f7ecea5df88cb12368650edfe7e6f50
          '0x5555555555555555555555555555555555555555555555555555555555555555',
          '0x4444444444444444444444444444444444444444444444444444444444444444',
        ],
        [ // 0x71c4c1dce220219d1703abc1b300f8f08e2dbe269e71bec1611970de65fd73f5
          [ // 0x812df6275efe49d72dced5ea25dba563eec3f57da8e4a891db7e1444a53fc181
            [ // 0x37df8a86dbd0a06a5a6720079d9a4ce5a5a5c93198607ca71402d78b7db2869e
              '0x6666666666666666666666666666666666666666666666666666666666666666',
              '0x7777777777777777777777777777777777777777777777777777777777777777',
            ],
            '0x3333333333333333333333333333333333333333333333333333333333333333',
          ],
          [ // 0x3e92e0db88d6afea9edc4eedf62fffa4d92bcdfc310dccbe943747fe8302e871
            '0x2222222222222222222222222222222222222222222222222222222222222222',
            '0x1111111111111111111111111111111111111111111111111111111111111111',
          ],
        ],
      ],
      leaves: [
        '0x3333333333333333333333333333333333333333333333333333333333333333',
        '0x1111111111111111111111111111111111111111111111111111111111111111',
      ],
    });
    expect(branch).deep.equal({
      branch: [
        '0x2222222222222222222222222222222222222222222222222222222222222222',
        '0x37df8a86dbd0a06a5a6720079d9a4ce5a5a5c93198607ca71402d78b7db2869e',
        '0x60c25b70d66af589f985b3cf4732585b8f7ecea5df88cb12368650edfe7e6f50',
      ],
      flags: [
        false,
        false,
        true,
        false,
      ],
    });
  });

  it('Should calc multi branch of 3 leaves of tree with 7 leaves', function () {
    const branch = calcFlexMultiBranch({
      tree: [
        [ // 0x60c25b70d66af589f985b3cf4732585b8f7ecea5df88cb12368650edfe7e6f50
          '0x5555555555555555555555555555555555555555555555555555555555555555',
          '0x4444444444444444444444444444444444444444444444444444444444444444',
        ],
        [ // 0x71c4c1dce220219d1703abc1b300f8f08e2dbe269e71bec1611970de65fd73f5
          [ // 0x812df6275efe49d72dced5ea25dba563eec3f57da8e4a891db7e1444a53fc181
            [ // 0x37df8a86dbd0a06a5a6720079d9a4ce5a5a5c93198607ca71402d78b7db2869e
              '0x6666666666666666666666666666666666666666666666666666666666666666',
              '0x7777777777777777777777777777777777777777777777777777777777777777',
            ],
            '0x3333333333333333333333333333333333333333333333333333333333333333',
          ],
          [ // 0x3e92e0db88d6afea9edc4eedf62fffa4d92bcdfc310dccbe943747fe8302e871
            '0x2222222222222222222222222222222222222222222222222222222222222222',
            '0x1111111111111111111111111111111111111111111111111111111111111111',
          ],
        ],
      ],
      leaves: [
        '0x3333333333333333333333333333333333333333333333333333333333333333',
        '0x1111111111111111111111111111111111111111111111111111111111111111',
        '0x5555555555555555555555555555555555555555555555555555555555555555',
      ],
    });
    expect(branch).deep.equal({
      branch: [
        '0x2222222222222222222222222222222222222222222222222222222222222222',
        '0x37df8a86dbd0a06a5a6720079d9a4ce5a5a5c93198607ca71402d78b7db2869e',
        '0x4444444444444444444444444444444444444444444444444444444444444444',
      ],
      flags: [
        false,
        false,
        false,
        true,
        true,
      ],
    });
  });
});
